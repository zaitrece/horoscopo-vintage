<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Horóscopo Vintage</title>
<style>
body{margin:0;background:#f4efe6;color:#222;font-family:system-ui,Segoe UI,Roboto,Arial;padding:20px}
h1{text-align:center;background:#1b1b1b;color:#f7ead9;padding:16px;border-bottom:4px solid #c2352b}
.container{max-width:860px;margin:20px auto;display:grid;gap:12px}
.card{background:#fff;border:2px solid #1b1b1b;border-radius:12px;padding:14px;box-shadow:6px 6px 0 #1b1b1b}
select,button{padding:10px 12px;border:2px solid #1b1b1b;border-radius:12px;background:#f7ead9;font-weight:700}
#resultado{white-space:pre-wrap;line-height:1.6}
#diag{font-family:monospace;color:#a00;background:#ffeaea;padding:10px;border-radius:8px;display:none}
</style>
</head>
<body>
  <h1>Horóscopo Vintage</h1>

  <div class="container">
    <section class="card">
      <label for="signo">Tu signo</label>
      <select id="signo">
        <option>Aries</option><option>Tauro</option><option>Géminis</option>
        <option>Cáncer</option><option>Leo</option><option>Virgo</option>
        <option>Libra</option><option>Escorpio</option><option>Sagitario</option>
        <option>Capricornio</option><option>Acuario</option><option>Piscis</option>
      </select>
      <button onclick="cargar()">Ver horóscopo</button>
      <button onclick="demo()">Forzar demo</button>
    </section>

    <section class="card">
      <article id="resultado">Elige signo y pulsa "Ver horóscopo"</article>
    </section>

    <section id="diag" class="card"></section>
  </div>

<script>
const MAP = {
  "Aries":"aries","Tauro":"taurus","Géminis":"gemini","Cáncer":"cancer","Leo":"leo","Virgo":"virgo",
  "Libra":"libra","Escorpio":"scorpio","Sagitario":"sagittarius","Capricornio":"capricorn",
  "Acuario":"aquarius","Piscis":"pisces"
};

async function cargar(){
  const signoES = document.getElementById("signo").value;
  const signoEN = MAP[signoES];
  const out = document.getElementById("resultado");
  out.textContent = "Cargando...";

  // texto de respaldo por si el JSON está vacío o no existe
  const demo = {
    current_date: new Date().toLocaleDateString("es-ES"),
    description: "Hoy la energía te favorece para ordenar prioridades y tomar decisiones sencillas.",
    compatibility: "—",
    mood: "—",
    color: "—"
  };

  try{
    const r = await fetch(`data/latest/${signoEN}.json?v=${Date.now()}`, {cache:"no-store"});
    if(!r.ok){
      // si no existe el archivo, usa demo
      out.textContent = `${signoES.toUpperCase()} — ${demo.current_date}\n\n${demo.description}\n\nCompatibilidad: ${demo.compatibility}\nHumor: ${demo.mood}\nColor: ${demo.color}`;
      return;
    }
    const d = await r.json();

    // Si la API falló y el workflow dejó placeholder vacío, usamos demo
    const desc = (d.description && d.description.trim().length>0) ? d.description : demo.description;
    const date = d.current_date || demo.current_date;
    const comp = d.compatibility || demo.compatibility;
    const mood = d.mood || demo.mood;
    const color = d.color || demo.color;

    out.textContent = `${signoES.toUpperCase()} — ${date}\n\n${desc}\n\nCompatibilidad: ${comp}\nHumor: ${mood}\nColor: ${color}`;
  }catch(e){
    // si hay cualquier error de red/JSON, mostramos demo
    out.textContent = `${signoES.toUpperCase()} — ${demo.current_date}\n\n${demo.description}\n\nCompatibilidad: ${demo.compatibility}\nHumor: ${demo.mood}\nColor: ${demo.color}`;
  }
}
</script>

</body>
</html>

